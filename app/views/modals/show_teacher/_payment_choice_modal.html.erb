<% cache [current_teacher, 'payment_choice_modal'] do %>
  <% if teacher_signed_in? %>  
    <div class="modal fade" id="payment_choice_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title" id="myModalLabel">Payment Options</h4>
          </div>
          <div class="modal-body">
            <div class="container-fluid">
              
                <%= select_tag 'location_choice', "<option>The where</option><option>My house</option><option>Teachers house</option>".html_safe %>
              
              <div class="row select_teachers_location">
                <h2>Check availability</h2>
                <%= form_for(@event, url: events_create_event_and_book_path, remote: true, html: { class: 'form-horizontal', id: 'create_event_form'}, method: 'post') do |f| %>
                                
                  <div class="form-group">
                    <label for="date" class="col-sm-2 control-label">Date:</label>
                    <div class="col-sm-10">
                      <input name="event[date]" type="text" id='payment_choice_datepicker' placeholder='Click to select date' class="payment_choice_date_picker" >
                    </div>
                  </div> <!-- end of form-group -->
                
                  <div class="row">
                    <div class='form-group'>
                      <%= label_tag 'start_time', 'Start time:', class: 'col-sm-2 control-label' %>
                      <div class="col-sm-10">
                        <%= f.time_select :start_time,
                              :combined => true,
                              :default => Time.now.change(:hour => 11, :min => 30),
                              :minute_interval => 30,
                              :time_separator => "",
                              :start_hour => 10,
                              :start_minute => 30,
                              :end_hour => 14,
                              :end_minute => 30
                            %>
                      </div> <!-- end of col-sm-8 -->
                    </div> <!-- end of form-group -->
                  </div>

                  <div class="row">
                    <div class="form-group">
                      <%= label_tag 'end_time', 'End time:', class: 'col-sm-2 control-label' %>
                      <div class="col-sm-10">
                        <%= f.time_select :end_time,
                                      :combined => true,
                                      :default => Time.now.change(:hour => 12, :min => 30),
                                      :minute_interval => 30,
                                      :time_separator => "",
                                      :start_hour => 10,
                                      :start_minute => 30,
                                      :end_hour => 14,
                                      :end_minute => 30
                                    %>
                      </div> <!-- end of col-sm-10 -->
                    </div> <!-- end of form-group -->
                  </div>
                    
                  <div class="form-group">
                    <div class="col-sm-10">
                      <div class="checkbox">                    
                        <label><%= check_box_tag 'Multiple', 'true' %>Block booking</label>
                        <span id="no_of_weeks" class="pull-right">Number of weeks: <%= select_tag "booking_length", options_for_select((2..52)) %></span>

                      </div> <!-- end of checkbox -->
                    </div> <!-- end of col-sm-10 -->
                  </div> <!-- end of form-group -->
                    <br>

                  <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                      <%= submit_tag 'Check availability', id: 'event_submit', class: 'btn btn-success' %>
                    </div> <!-- end of col-sm-10 -->
                  </div> <!-- end of form-group  -->
                  <%= hidden_field_tag 'event[subject_id]', @subject.id %>
                  <%= hidden_field_tag 'event[teacher_id]', @teacher.id %>
                  <%= hidden_field_tag 'event[student_id]', current_teacher.id if teacher_signed_in? %>
                <% end %> <!-- end of form_tag  -->
              </div> <!-- end of select_teachers_location -->

              <div class="row select_home_lesson">
                <div class="container-fluid">
                              
                    <% if @teacher.paypal_email != "" %>
                      <div class="col-xs-6">
                        <%= form_tag home_booking_paypal_path, class: 'home_booking_form', method: 'post' do %>
                          
                          <%= hidden_field_tag :teacher_id, @teacher.id %>
                          <%= hidden_field_tag :student_id, current_teacher.id %>
                          <%= hidden_field_tag :student_name, current_teacher.full_name %>
                          <%= hidden_field_tag :student_email, @current_teacher.email %>
                          <%= hidden_field_tag :teacher_email, @teacher.email %>
                          
                          <% if defined? @home_price.price %>
                            <%= hidden_field_tag :receiver_amount, @home_price.price.to_f %>
                          <% end %>
                          <%= hidden_field_tag :start_time, Time.now %>
                          <%= hidden_field_tag :end_time, Time.now %>
                          <%= hidden_field_tag :paypal, '1' %>
                          <%= hidden_field_tag :home_address, '', class: 'home_address' %>
                          <%= hidden_field_tag :save_address, 'false', class: 'save_address' %>
                          <%# hidden_field_tag :tracking_id, '', class: 'tracking_id' %>
                          <%= image_submit_tag 'https://www.paypalobjects.com/en_US/i/btn/x-click-but6.gif', class: 'img-responsive' %>
                        <% end %>
                      </div> <!-- end of col-md-6-->
                    <% end %> <%# end of @teacher.paypal_email != "" %>

                    <% if @teacher.stripe_access_token != "" %>
                      
                      <div class="col-xs-6">
                        <%= form_tag home_booking_stripe_path, class: 'home_booking_form', method: 'post' do %>
                        <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                          data-key="pk_test_bedFzS7vnmzthkrQolmUjXNn"
                          data-description="Book your lesson"
                          data-currency="eur"
                          data-description="This is the description"
                          data-imgage="<%= asset_url 'stripe.png' %>"
                          ></script>
                          <%= hidden_field_tag :teacher_id, @teacher.id %>
                          <%= hidden_field_tag :student_id, current_teacher.id %>
                          <%= hidden_field_tag :student_name, current_teacher.full_name %>
                          <%= hidden_field_tag :student_email, @current_teacher.email %>
                          <%= hidden_field_tag :teacher_email, @teacher.email %>
                          <% if defined? @home_price.price %>
                            <%= hidden_field_tag :amount, @home_price.price.to_f %>
                          <% end %>              
                                 
                          <%= hidden_field_tag :current_teacher, current_teacher.id %> 
                          <%= hidden_field_tag :start_time, Time.now %>           
                          <%= hidden_field_tag :end_time, Time.now %>   
                          <%= hidden_field_tag :home_address, '', class: 'home_address' %>        
                          <%= hidden_field_tag :save_address, 'false', class: 'save_address' %>
                        <% end %>
                      </div> <!-- end of col-xs-6-->

                    <% end %> <%# end of  @teacher.stripe_access_token != "" %>
                </div> <!-- end of container-fluid -->
                <div class="well">
                    Enter your address. We can remember this for you if you want. 
                  </div>
                <form class="form-horizontal">
                  <div class="form-group">
                    <label for="address" class="col-sm-2 control-label">Address</label>
                    <div class="col-sm-10">
                      <%= text_field_tag 'address', current_teacher.address, placeholder: 'Address',size: 40, id: 'home_booking_address' %>
                      
                    </div>
                  </div>

                  <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                      <div class="checkbox">
                        <label>
                          <%= check_box_tag 'Remember', 'Remember address', current_teacher.address != '', id:'remember' %>Remember Address
                        </label>
                      </div>
                    </div>
                  </div>
                  
                </form>
              </div>
            </div> <!-- end of container-fluid -->
          </div> <!-- end of modal-body -->
        </div> <!-- end of modal-content -->
      </div> <!-- end of modal-dialog -->
    </div> <!-- end of modal fade -->
  <% end %> <!-- if teacher_signed_in? -->
<% end %> <%# end of cache %>